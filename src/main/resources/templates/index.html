<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">
<head lang="en">
    <title>Title</title>
    <!--jQuery dependencies-->
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>

    <!--Include Touch Punch file to provide support for touch devices-->
    <script type="text/javascript" src="js/touch/jquery.ui.touch-punch.min.js" ></script>

    <!--ParamQuery Grid files-->
    <link rel="stylesheet" href="css/pqgrid.min.css" />
    <script type="text/javascript" src="js/pqgrid.min.js" ></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function () {
            var data = [[1, 'Exxon Mobil', '339,938.0', '36,130.0'],
                [2, 'Wal-Mart Stores', '315,654.0', '11,231.0'],
                [3, 'Royal Dutch Shell', '306,731.0', '25,311.0'],
                [4, 'BP', '267,600.0', '22,341.0'],
                [5, 'General Motors', '192,604.0', '-10,567.0'],
                [6, 'Chevron', '189,481.0', '14,099.0'],
                [7, 'DaimlerChrysler', '186,106.3', '3,536.3'],
                [8, 'Toyota Motor', '185,805.0', '12,119.6'],
                [9, 'Ford Motor', '177,210.0', '2,024.0'],
                [10, 'ConocoPhillips', '166,683.0', '13,529.0'],
                [11, 'General Electric', '157,153.0', '16,353.0'],
                [12, 'Total', '152,360.7', '15,250.0'],
                [13, 'ING Group', '138,235.3', '8,958.9'],
                [14, 'Citigroup', '131,045.0', '24,589.0'],
                [15, 'AXA', '129,839.2', '5,186.5'],
                [16, 'Allianz', '121,406.0', '5,442.4'],
                [17, 'Volkswagen', '118,376.6', '1,391.7'],
                [18, 'Fortis', '112,351.4', '4,896.3'],
                [19, 'CrÃ©dit Agricole', '110,764.6', '7,434.3'],
                [20, 'American Intl. Group', '108,905.0', '10,477.0']];

            var obj = {width: 700, height: 400,
                title: "ParamQuery Grid Example",
                resizable: true,
                draggable: true,
                resizable:true,
                flexHeight: true,
                flexWidth:true,
            pageModel: {type: "local", rPP: 10, rPPOptions: [1, 10, 20, 30, 40, 50, 100, 1000]},
            track: true,
            toolbar: {
                items: [{type: 'button', icon: 'ui-icon-plus', label: 'Add Row', listeners: [
                {"click": function (evt, ui) {
                    //append empty row at the end
                    var rowData = {Discontinued: false};
                    var rowIndx = $grid.pqGrid("addRow", {rowData: rowData});
                    $grid.pqGrid("goToPage", { rowIndx: rowIndx });
                    $grid.pqGrid("editFirstCellInRow", { rowIndx: rowIndx });
                    
                }
                }
                ]
             },
                    {type: 'button', icon: 'ui-icon-disk', label: 'Save Changes', style: 'margin: 0px 5px;', listeners:[
                        {"click": function (evt, ui) {
                            acceptChanges();
                        }}
                    ]},
                    {type: 'button', icon: 'ui-icon-cancel', label: 'Discard Changes', style: 'margin: 0px 5px;', listeners:[
                        {"click": function (evt, ui) {
                            $grid.pqGrid("rollback");
                        }}
                    ]},
                    {type: 'separator'},
                    {type: 'button', icon: 'ui-icon-cart', label: 'Get Changes', style: 'margin: 0px 5px', listeners: [
                        {"click": function (evt, ui) {
                          var changes = $grid.pqGrid("getChanges");
                            try{
                                console.log(changes);
                            }catch (ex){}
                            alert("Please see the log of changes in your browser console.");
                        }}
                    ]}
            ]
            },
            scrollModel: {
                autoFit: true
            },
                selectionModel: {
                    type: ''
                },
                editModel: {
                    saveKey: $.ui.keyCode.ENTER
                },
                refresh: function () {
                    $("#grid-array").find("button.delete_btn").button({ icons: { primary: 'ui-icon-scissors'}})
                            .unbind("click")
                            .bind("click", function (evt) {
                                var $tr = $this.closest("tr");
                                var obj = $grid.pgGrid("getRowIndx", {$tr: $tr});
                                var rowIndx = obj.rowIndx;
                                $grid.pqGrid("addClass", { rowIndx: rowIndx, cls: 'pq-row-delete' });

                                var ans = window.confirm("Are you sure to delete row No " + (rowIndx + 1) + "?");

                                if(ans){
                                    $grid.pqGrid("deleteRow", { rowIndx: rowIndx, effect: true, complete: function () {
                                        $grid.pqGrid("removeClass", { rowIndx: rowIndx, cls: 'pq-row-delete' });
                                    }
                                    });
                                }else{
                                    $grid.pqGrid("removeClass", {rowIndx: rowIndx, cls: 'pq-row-delete'});
                                }
                            });
                }
            };
            obj.colModel = [{title: "Rank", width: 100, dataType: "integer"},
                {title: "Company", width: 150, dataType: "string"},
                {title: "Revenues ($ millions)", width: 150, dataType: "float", align: "right"},
                {title: "Profits ($ millions)", width: 150, dataType: "float", align: "right"},
                { title: "", editable: false, minWidth: 83, sortable: false, render: function (ui) {
                    return "<button type='button' class='delete_btn'>Delete</button>";
                }
                }];
            obj.dataModel = {data: data};
            var $grid = $("#grid-array").pqGrid(obj);
            var grid = $grid.data("paramqueryPqGrid");
        });
        //called when accept changes button is clicked.
        function acceptChanges() {
            //attempt to save editing cell.
            //debugger;
            if (grid.saveEditCell() === false) {
                return false;
            }

            var isDirty = grid.isDirty();
            if (isDirty) {
                //validate the new added rows.
                var addList = grid.getChanges().addList;
                for (var i = 0; i < addList.length; i++) {
                    var rowData = addList[i];
                    var isValid = grid.isValid({ "rowData": rowData }).valid;
                    if (!isValid) {
                        return;
                    }
                }
                var changes = grid.getChanges({ format: "byVal" });

                //post changes to server
                $.ajax({
                    dataType: "json",
                    type: "POST",
                    async: true,
                    beforeSend: function (jqXHR, settings) {
                        grid.showLoading();
                    },
                    url: "/pro/products/batch", //for ASP.NET, java
                    data: { list: JSON.stringify(changes) },
                    success: function (changes) {
                        //debugger;
                        grid.commit({ type: 'add', rows: changes.addList });
                        grid.commit({ type: 'update', rows: changes.updateList });
                        grid.commit({ type: 'delete', rows: changes.deleteList });

                    },
                    complete: function () {
                        grid.hideLoading();
                    }
                });
            }
        }
        /*]]>*/

    </script>
</head>
<body>
<div id="grid-array" style="margin:100px;"></div>
</body>
</html>